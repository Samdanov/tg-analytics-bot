# Функционал парсинга и анализа веб-сайтов

## Описание

Бот "ОРБИТА" теперь поддерживает анализ веб-сайтов аналогично анализу Telegram каналов. При отправке ссылки на сайт бот автоматически:

1. **Парсит содержимое сайта** - загружает HTML страницу
2. **Очищает от мусора** - удаляет рекламу, навигацию, футеры, скрипты
3. **Извлекает основной текст** - получает чистый текстовый контент
4. **Уменьшает токены** - суммаризация и фильтрация до 8000 символов
5. **Анализирует через LLM** - определяет ключевые слова и целевую аудиторию
6. **Находит похожие каналы** - ищет в базе Telegram каналов по ключевым словам
7. **Генерирует Excel отчет** - создает файл с похожими каналами

## Использование

### Отправка ссылки на сайт

Просто отправьте боту ссылку на сайт в любом формате:
- `https://example.com`
- `http://example.com`
- `www.example.com`
- `example.com`

Бот автоматически определит, что это веб-сайт (не Telegram канал) и предложит выбрать количество похожих каналов для анализа.

### Процесс работы

1. Бот определяет тип ссылки (сайт или канал)
2. Для сайта предлагает выбрать количество каналов (10/25/50/100/500)
3. Парсит сайт и извлекает текст
4. Анализирует через LLM
5. Находит похожие каналы в базе
6. Генерирует и отправляет Excel отчет

## Технические детали

### Очистка HTML

Удаляются следующие элементы:
- `<script>`, `<style>` - скрипты и стили
- `<nav>`, `<header>`, `<footer>`, `<aside>` - навигация
- Элементы с классами/ID: `ad`, `advertisement`, `banner`, `cookie`, `popup`, `modal`, `menu`, `navigation`, `sidebar`, `comment`, `social`, `share`

### Уменьшение токенов

- Удаление повторяющихся фраз
- Фильтрация коротких предложений (< 20 символов)
- Удаление предложений только из цифр
- Ограничение длины до 8000 символов

### Поиск похожих каналов

Используется алгоритм на основе TF-IDF:
- Нормализация ключевых слов
- Вычисление пересечения с ключевыми словами каналов
- Score на основе количества совпадений
- Фильтрация шумовых каналов

## Структура файлов

### Новые модули

1. **`app/services/website_parser/parser.py`**
   - Парсинг веб-сайтов
   - Очистка HTML от мусора
   - Извлечение и суммаризация текста

2. **`app/services/similarity_engine/website_similarity.py`**
   - Поиск похожих каналов по ключевым словам
   - Без сохранения сайта в БД

3. **`app/services/usecases/website_service.py`**
   - Полный пайплайн анализа сайта
   - Генерация Excel отчетов для сайтов

### Обновленные модули

1. **`app/services/llm/analyzer.py`**
   - Добавлена функция `analyze_text_content()` для анализа текста сайтов

2. **`app/bot/handlers/workflow.py`**
   - Определение типа ссылки (сайт/канал)
   - Обработчик `analyze_website_callback()` для анализа сайтов

## Зависимости

Добавлено в `requirements.txt`:
- `aiohttp` - для асинхронных HTTP запросов

Установка:
```bash
pip install aiohttp
```

## Ограничения

- Таймаут загрузки: 10 секунд
- Максимальная длина текста: 8000 символов
- Минимальное количество совпадений ключевых слов: 2
- Поддерживаются только HTML страницы

## Примеры использования

### Пример 1: Анализ сайта компании

1. Отправьте: `https://example.com`
2. Выберите: 100 каналов
3. Получите Excel с похожими Telegram каналами

### Пример 2: Анализ блога

1. Отправьте: `https://blog.example.com/article`
2. Выберите: 50 каналов
3. Получите список каналов с похожей тематикой

## Отличия от анализа каналов

- **Не сохраняется в БД** - сайты не добавляются в базу каналов
- **Прямой поиск** - поиск похожих каналов по ключевым словам без сохранения
- **Один анализ** - каждый раз парсится заново (нет кеширования)

## Устранение неполадок

### Сайт не парсится

- Проверьте доступность сайта
- Убедитесь, что сайт возвращает HTML (не JSON API)
- Проверьте таймаут (может быть слишком медленный сайт)

### Не найдены похожие каналы

- Убедитесь, что в базе есть каналы с похожими ключевыми словами
- Попробуйте увеличить количество каналов (100 или 500)
- Проверьте, что LLM правильно извлек ключевые слова
