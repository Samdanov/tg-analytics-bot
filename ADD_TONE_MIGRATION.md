# Миграция: добавление поля tone (тональность)

## Описание

Добавлено поле `tone` (тональность) в таблицу `keywords_cache` для хранения информации о стиле подачи контента канала.

## Изменения

1. **Модель БД** (`app/db/models.py`):
   - Добавлено поле `tone = Column(Text)` в класс `KeywordsCache`

2. **Сохранение анализа** (`app/services/llm/analyzer.py`):
   - Функция `save_analysis()` теперь сохраняет тональность из результата LLM

3. **Вывод карточки** (`app/services/helpers.py`):
   - Функция `build_channel_summary()` теперь выводит тональность (как для сайтов)

## Применение миграции

Выполните SQL команду для добавления колонки:

```bash
psql -d tg_analytics -c "ALTER TABLE keywords_cache ADD COLUMN IF NOT EXISTS tone TEXT;"
```

Или используйте файл миграции:

```bash
psql -d tg_analytics -f app/db/migrations/add_tone_column.sql
```

## Проверка

После применения миграции проверьте структуру таблицы:

```bash
psql -d tg_analytics -c "\d keywords_cache"
```

Должна появиться колонка `tone` типа `text`.

## Что изменится

После применения миграции:
- При анализе каналов тональность будет сохраняться в БД
- В карточке канала будет отображаться тональность (если она есть)
- Формат аналогичен карточке сайта

## Примечание

Для существующих записей поле `tone` будет `NULL`. При следующем анализе канала тональность будет заполнена.
