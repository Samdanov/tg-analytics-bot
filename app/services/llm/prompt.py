# app/services/llm/prompt.py
"""
Промпты для LLM анализа каналов.

ВАЖНО:
- category должен быть из списка 48 тем (PRIMARY TOPIC)
- keywords должны быть ОТДЕЛЬНЫМИ словами (для TF-IDF)
"""

# 48 категорий из Excel (для валидации)
VALID_CATEGORIES = [
    "telegram",
    "бизнес и стартапы",
    "блоги",
    "букмекерство",
    "видео и фильмы",
    "даркнет",
    "дизайн",
    "для взрослых",
    "другое",
    "еда и кулинария",
    "здоровье и фитнес",
    "игры",
    "инстаграм",
    "интерьер и строительство",
    "искусство",
    "картинки и фото",
    "карьера",
    "книги",
    "криптовалюты",
    "курсы и гайды",
    "лингвистика",
    "маркетинг, pr, реклама",
    "медицина",
    "мода и красота",
    "музыка",
    "новости и сми",
    "образование",
    "познавательное",
    "политика",
    "право",
    "природа",
    "продажи",
    "психология",
    "путешествия",
    "религия",
    "рукоделие",
    "семья и дети",
    "софт и приложения",
    "спорт",
    "технологии",
    "транспорт",
    "цитаты",
    "шок-контент",
    "эзотерика",
    "экономика",
    "эротика",
    "юмор и развлечения",
]


def build_analysis_prompt(description: str, posts_text: str) -> str:
    categories_list = "\n".join(f"   • {cat}" for cat in VALID_CATEGORIES)
    
    return f"""Ты — эксперт по классификации Telegram-каналов. Твоя задача: определить категорию, целевую аудиторию и ключевые слова.

**ВХОДНЫЕ ДАННЫЕ:**

Описание канала:
\"\"\"
{description}
\"\"\"

Последние посты:
\"\"\"
{posts_text}
\"\"\"

**ЗАДАЧА:**

1. **КАТЕГОРИЯ** — СТРОГО выбери ОДНУ из этого списка (копируй название ТОЧНО!):
{categories_list}

   ⚠️ КРИТИЧЕСКИ ВАЖНО:
   • Выбирай ТОЛЬКО из списка выше — НИКАКИХ других категорий!
   • Копируй название ТОЧНО как в списке (с маленькой буквы, с запятыми если есть)
   • НЕ выдумывай свои категории!
   
   Когда назначать "другое":
   • Канал слишком общий (обо всём понемногу)
   • Канал странный или непонятный
   • Микс из разных тем без явной основной
   • Личный блог без чёткой тематики
   • Не подходит ни одна категория из списка
   
   Подсказки по выбору:
   • IT/разработка/программирование → "технологии"
   • Деньги/финансы/инвестиции → "экономика"
   • Реклама/SMM/продвижение → "маркетинг, pr, реклама"
   • Крипта/биткоин/блокчейн → "криптовалюты"
   • Обучение/курсы → "образование" или "курсы и гайды"
   • Авто/мото/транспорт → "транспорт"
   • Юридические вопросы → "право"
   • Врачи/лечение → "медицина"
   • ЗОЖ/спортзал/питание → "здоровье и фитнес"

2. **ЦЕЛЕВАЯ АУДИТОРИЯ** — кратко:
   • Кто читает (профессия, интересы)
   • Зачем подписаны

3. **КЛЮЧЕВЫЕ СЛОВА** (10-15 штук) — для поиска похожих каналов:
   
   ТОЛЬКО ОТДЕЛЬНЫЕ слова!
   
   ✓ ПРАВИЛЬНО: "python", "разработка", "backend", "api"
   ✗ НЕПРАВИЛЬНО: "machine learning", "data science"
   
   Разбивай фразы:
   • "machine learning" → "ml" или "machine", "learning"
   • "контент-маркетинг" → "контент", "маркетинг"
   
   Правила:
   • Каждое слово ОТДЕЛЬНО
   • Русские — единственное число, именительный падеж
   • Латинские термины — как есть (python, api)
   • БЕЗ общих слов (канал, пост, новости, telegram)

4. **ТОНАЛЬНОСТЬ** — стиль подачи (кратко)

**ФОРМАТ ОТВЕТА (строго JSON):**
{{
  "category": "точное название из списка",
  "audience": "описание аудитории",
  "tone": "стиль канала",
  "keywords": ["слово1", "слово2", ...]
}}

**ПРИМЕРЫ:**

Канал про Python:
{{
  "category": "технологии",
  "audience": "Python-разработчики",
  "tone": "Технический",
  "keywords": ["python", "django", "api", "backend", "разработка", "код"]
}}

Канал про SMM:
{{
  "category": "маркетинг, pr, реклама",
  "audience": "SMM-специалисты",
  "tone": "Практический",
  "keywords": ["smm", "реклама", "таргет", "продвижение", "маркетинг"]
}}

Личный блог обо всём:
{{
  "category": "другое",
  "audience": "Друзья и знакомые автора",
  "tone": "Личный, неформальный",
  "keywords": ["блог", "мысли", "жизнь", "автор"]
}}

Отвечай ТОЛЬКО JSON, без текста."""
