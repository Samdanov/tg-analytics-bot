def build_analysis_prompt(description: str, posts_text: str) -> str:
    return f"""Ты — эксперт по анализу Telegram-каналов. Твоя задача: точно определить целевую аудиторию и ключевые темы канала на основе предоставленных данных.

**ВХОДНЫЕ ДАННЫЕ:**

Описание канала:
\"\"\"
{description}
\"\"\"

Последние посты:
\"\"\"
{posts_text}
\"\"\"

**ЗАДАЧА:**

0. **Анализ типа канала** (сначала определи!):
   • Новостной/обзорный — публикует разные темы и новости
   • Специализированный — фокус на одной технологии/методике
   • Образовательный — туториалы, курсы, разборы
   • Развлекательный — мемы, юмор на определённую тему

1. **Целевая аудитория** — определи максимально конкретно:
   • Основные сегменты (возраст, пол, профессия/роль)
   • Ключевые интересы и боли аудитории
   • Зачем они подписаны (образование, развлечение, новости, бизнес)
   • Уровень экспертности (новички, специалисты, профи)
   
2. **Ключевые слова** (10-20 штук) — для поиска похожих каналов:
   
   КРИТИЧЕСКИ ВАЖНО — различай уровни абстракции:
   
   **Для новостных/обзорных каналов:**
   • Выбирай КАТЕГОРИИ и НАПРАВЛЕНИЯ, а не конкретные продукты из новостей
   • Пример ПЛОХО: "Discord", "Roblox", "Windows 11" (это темы отдельных новостей)
   • Пример ХОРОШО: "технологии", "гаджеты", "кибербезопасность", "нейросети", "игры"
   
   **Для специализированных каналов:**
   • Можно использовать конкретные технологии/методологии
   • Пример: "Python", "DevOps", "таргетированная реклама", "контент-маркетинг"
   
   **Общие правила:**
   • Группируй похожие темы (все про AI → "нейросети", "машинное обучение")
   • Добавляй смежные области (для IT-новостей: "стартапы", "инновации")
   • НЕ включай названия конкретных продуктов, если канал обзорный
   • НЕ включай общие слова (новости, канал, пост)
   • Технические термины пиши ЛАТИНИЦЕЙ (ChatGPT, DevOps, VPN)

3. **Тональность** — кратко опиши стиль подачи:
   • Формальный/неформальный, экспертный/развлекательный
   • Эмоциональная окраска (мотивирующий, ироничный, нейтральный)

**ПРАВИЛА (обязательны!):**
✓ СНАЧАЛА определи тип канала (п.0), ПОТОМ выбирай уровень ключевых слов
✓ Новостной канал → категории и направления (технологии, гаджеты, AI)
✓ Специализированный → конкретные технологии (Python, Docker, React)
✓ Используй ТОЛЬКО информацию из описания и постов
✓ Если данных мало — пиши "по косвенным признакам", "вероятно"
✓ Русские слова — в единственном числе, именительном падеже (нейросеть, реклама, бизнес)
✓ Латинские термины — как есть, в оригинале (Discord, ChatGPT, не переводи!)
✓ НЕ придумывай факты, которых нет в текстах
✓ НЕ используй внешние знания о канале
✓ Ответ СТРОГО в формате JSON

**ПРИМЕРЫ ХОРОШИХ КЛЮЧЕВЫХ СЛОВ:**

Новостной IT-канал (обзорный):
✓ "технологии", "гаджеты", "софт", "кибербезопасность", "нейросети", "игры", "стартапы", "инновации", "VPN", "privacy"
✗ "Discord", "Roblox", "Windows 11", "Qwen" (это темы отдельных новостей, не суть канала)

Специализированный Python-канал:
✓ "Python", "backend", "Django", "FastAPI", "data science", "machine learning", "async", "разработка"
✗ "технологии", "программирование" (слишком общие для узкого канала)

Бизнес-канал (кейсы стартапов):
✓ "стартап", "венчур", "метрика", "продажи", "B2B", "SaaS", "инвестиции", "unit-экономика"

Канал по нейросетям:
✓ "нейросети", "ChatGPT", "Midjourney", "генерация", "prompt", "AI", "машинное обучение", "автоматизация"

**ПРАВИЛО:** Если канал публикует новости/обзоры на разные темы — выбирай КАТЕГОРИИ. Если канал узкоспециализированный — можно конкретные технологии.

**ФОРМАТ ОТВЕТА:**
{{
  "audience": "Конкретное описание ЦА: кто они, зачем читают, какой уровень. Примеры: 'IT-специалисты 25-40 лет, изучающие backend-разработку' или 'Предприниматели и основатели стартапов, ищущие кейсы роста'",
  "tone": "Стиль и тон канала. Примеры: 'Экспертный, с техническими деталями' или 'Неформальный, с мемами и иронией'",
  "keywords": ["слово1", "слово2", "слово3", ...]
}}

Отвечай ТОЛЬКО JSON, без дополнительного текста."""
