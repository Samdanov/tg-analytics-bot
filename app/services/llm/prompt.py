# app/services/llm/prompt.py
"""
Промпты для LLM анализа каналов.

ВАЖНО:
- category должен быть из списка 48 тем (PRIMARY TOPIC)
- keywords должны быть ОТДЕЛЬНЫМИ словами (для TF-IDF)
"""

# 48 категорий из Excel (для валидации)
VALID_CATEGORIES = [
    "telegram",
    "бизнес и стартапы",
    "блоги",
    "букмекерство",
    "видео и фильмы",
    "даркнет",
    "дизайн",
    "для взрослых",
    "другое",
    "еда и кулинария",
    "здоровье и фитнес",
    "игры",
    "инстаграм",
    "интерьер и строительство",
    "искусство",
    "картинки и фото",
    "карьера",
    "книги",
    "криптовалюты",
    "курсы и гайды",
    "лингвистика",
    "маркетинг, pr, реклама",
    "медицина",
    "мода и красота",
    "музыка",
    "новости и сми",
    "образование",
    "познавательное",
    "политика",
    "право",
    "природа",
    "продажи",
    "психология",
    "путешествия",
    "религия",
    "рукоделие",
    "семья и дети",
    "софт и приложения",
    "спорт",
    "технологии",
    "транспорт",
    "цитаты",
    "шок-контент",
    "эзотерика",
    "экономика",
    "эротика",
    "юмор и развлечения",
]


def build_analysis_prompt(description: str, posts_text: str) -> str:
    categories_list = "\n".join(f"   • {cat}" for cat in VALID_CATEGORIES)
    
    return f"""Ты — эксперт по анализу Telegram-каналов. Твоя задача: определить категорию, целевую аудиторию и ключевые слова канала.

**ВХОДНЫЕ ДАННЫЕ:**

Описание канала:
\"\"\"
{description}
\"\"\"

Последние посты:
\"\"\"
{posts_text}
\"\"\"

**ЗАДАЧА:**

1. **КАТЕГОРИЯ** (обязательно!) — выбери ОДНУ из списка:
{categories_list}

   Правила выбора категории:
   • Выбирай ОСНОВНУЮ тему канала
   • Если канал про IT/разработку → "технологии"
   • Если канал про деньги/финансы/инвестиции → "экономика"  
   • Если канал про рекламу/SMM/продвижение → "маркетинг, pr, реклама"
   • Если канал про обучение → "образование" или "курсы и гайды"
   • Если не подходит ничего → "другое"

2. **ЦЕЛЕВАЯ АУДИТОРИЯ** — кратко опиши:
   • Кто читает канал (профессия, интересы)
   • Зачем подписаны (образование, развлечение, работа)

3. **КЛЮЧЕВЫЕ СЛОВА** (10-15 штук) — для поиска похожих каналов:
   
   КРИТИЧЕСКИ ВАЖНО — только ОТДЕЛЬНЫЕ слова!
   
   ✓ ПРАВИЛЬНО: "python", "разработка", "backend", "api", "django"
   ✗ НЕПРАВИЛЬНО: "machine learning", "data science", "контент-маркетинг"
   
   Если термин из 2+ слов — разбей:
   • "machine learning" → "machine", "learning" (или просто "ml")
   • "data science" → "data", "science" (или просто "datascience")
   • "контент-маркетинг" → "контент", "маркетинг"
   
   Правила:
   • Каждое слово ОТДЕЛЬНО
   • Русские слова — единственное число, именительный падеж
   • Латинские термины — как есть (python, api, crm)
   • Аббревиатуры допустимы (ml, ai, seo, smm)
   • НЕ включай общие слова (канал, пост, новости)

4. **ТОНАЛЬНОСТЬ** — стиль подачи (кратко)

**ФОРМАТ ОТВЕТА (строго JSON!):**
{{
  "category": "одна из категорий списка",
  "audience": "описание целевой аудитории",
  "tone": "стиль и тон канала",
  "keywords": ["слово1", "слово2", "слово3", ...]
}}

**ПРИМЕРЫ:**

Канал про Python-разработку:
{{
  "category": "технологии",
  "audience": "Python-разработчики, изучающие backend",
  "tone": "Экспертный, технический",
  "keywords": ["python", "django", "flask", "api", "backend", "разработка", "код", "программирование"]
}}

Канал про SMM и рекламу:
{{
  "category": "маркетинг, pr, реклама",
  "audience": "SMM-специалисты и маркетологи",
  "tone": "Практический, с кейсами",
  "keywords": ["smm", "реклама", "таргет", "продвижение", "контент", "instagram", "маркетинг"]
}}

Канал про инвестиции:
{{
  "category": "экономика",
  "audience": "Инвесторы и трейдеры",
  "tone": "Аналитический",
  "keywords": ["инвестиции", "акции", "биржа", "трейдинг", "портфель", "дивиденды", "финансы"]
}}

Отвечай ТОЛЬКО JSON, без дополнительного текста."""
